<!DOCTYPE html>
<html>
<head>
	<title>Friend Finder</title>

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

	<!-- Materialize -->
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">


	<!-- mobile compat -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

	<!-- Sticky Footer -->
	<style>
		body {
	    display: flex;
	    min-height: 100vh;
	    flex-direction: column;
	  }

	  main {
	    flex: 1 0 auto;
	  }
	</style>
</head>
<body>

	<!-- Modal to be shown after submission -->
	<div id="modal1" class="modal">
		<!-- Modal content id is currently empty, will be populated and displayed after submit -->
		<div class="modal-content center-align">

			<h1><strong>Your Match</strong></h1>
			<div class="divider"></div>
			<br>
			<div id="content"></div>

		</div>
		<div class="modal-footer">
			<div class="row">
				<a class="modal-close waves-effect waves-light btn-flat" href="#!">Dismiss</a>
			</div>
		</div>
	</div>

	<!-- Navbar -->
	<!-- Just basic logo, no added links necessary -->
	<header>
		<nav>
			<div class="nav-wrapper">
				<a href="/" class="brand-logo center">Friend Finder</a>
			</div>
		</nav>
	</header>

	<main class="blue-grey lighten-4">
		<div class="center-align">
			<h1>Survey</h1>
			<h4>Find your match!</h4>
			<p>Please answer as truthfully as you'd like.  Make sure you enjoy it!</p>
		</div>

		<div class="container">
			<div class="col s12">
				<div class="row">
					<form>
						<div class="input-field col s12">
							<input placeholder="Jane" type="text" id="name">
							<label for="name">First Name</label>
						</div>

						<!-- For each question, we must create an individual div -->
						<!-- Before each div will be the question, and at the end will be the submit button -->
						<h5>What number do you like best?</h5>
						<div class="input-field col s12">
							<select class="question">
								<option value="" disabled selected>Make Your Choice</option>
							    <option value="1">1 - Strongly Disagree</option>
							    <option value="2">2 - Disagree</option>
							    <option value="3">3 - No Preference</option>
								<option value="4">4 - Agree</option>
								<option value="5">5 - Strongly Agree</option>
							</select>
						</div>

						<h5>I am a person that deserves to have friends.</h5>
						<div class="input-field col s12">
							<select class="question">
								<option value="" disabled selected>Make Your Choice</option>
							    <option value="1">1 - Strongly Disagree</option>
							    <option value="2">2 - Disagree</option>
							    <option value="3">3 - No Preference</option>
								<option value="4">4 - Agree</option>
								<option value="5">5 - Strongly Agree</option>
							</select>
						</div>

						<h5>I am constantly looking to improve myself.</h5>
						<div class="input-field col s12">
							<select class="question">
								<option value="" disabled selected>Make Your Choice</option>
							    <option value="1">1 - Strongly Disagree</option>
							    <option value="2">2 - Disagree</option>
							    <option value="3">3 - No Preference</option>
								<option value="4">4 - Agree</option>
								<option value="5">5 - Strongly Agree</option>
							</select>
						</div>

						<h5>I enjoy learning new things, and finding new hobbies.</h5>
						<div class="input-field col s12">
							<select class="question">
								<option value="" disabled selected>Make Your Choice</option>
							    <option value="1">1 - Strongly Disagree</option>
							    <option value="2">2 - Disagree</option>
							    <option value="3">3 - No Preference</option>
								<option value="4">4 - Agree</option>
								<option value="5">5 - Strongly Agree</option>
							</select>
						</div>

						<h5>I prefer spending time alone than with other people.</h5>
						<div class="input-field col s12">
							<select class="question">
								<option value="" disabled selected>Make Your Choice</option>
							    <option value="1">1 - Strongly Disagree</option>
							    <option value="2">2 - Disagree</option>
							    <option value="3">3 - No Preference</option>
								<option value="4">4 - Agree</option>
								<option value="5">5 - Strongly Agree</option>
							</select>
						</div>
					</form>

					<!-- Submit Button -->
					<a class="waves-effect waves-light btn-large col s12 modal-trigger" href="#modal1" id="submit">Submit</a>
				</div>
			</div>
		</div>
	</main>

	<footer class="page-footer">
		<div class="footer-copyright">
			<div class="container center-align">
			Â© Kevin Castro, 2018
			</div>
		</div>
	</footer>

	<!-- JQuery -->
	<script type="text/javascript" src="http://code.jquery.com/jquery-3.3.1.min.js"></script>

	<!-- Compiled and minified JavaScript -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

	<script type="text/javascript">
		// Initialize selects on page load
		// this is a materialize req
		$(document).ready(() => {
			$('select').material_select();
			//open it as per materialize docs
			$('.modal').modal();
		});

		let hasBeenClicked = false;

		// submit on click
		$('#submit').on('click', () => {
			//if the button has been clicked before, do nothing.
			if (hasBeenClicked){return;}

			// collect the name
			const name = $('#name').val().trim()

			// create an array with the scores
			let scoresData = [];

			//for each select in question class
			$('.question').each(function() {
				//get the scores
				scoresData.push($(this).val());
			});

			// for some reason, it inputs an empty string val for the above each() call
			// we simply just filter out the empty elements
			// interestingly enough, we can return the val we're on, which will pick up
			// whether it's truthy or falsy
			scoresData = scoresData.filter(answer => answer);

			scoresData = scoresData.map(parseFloat);

			// for demo purposes, will not use image link, just get one randomly
			// from randomuser.me API
			$.ajax({
				url: 'https://randomuser.me/api/',
				dataType: 'json',
				//callback
				success: function(data) {
					//get link to thumbnail image
					const img = data.results[0].picture.large;

					// build object:
					// for some reason the key for the array gets renamed to
					// "scores[]"
					// cannot for the life of me get it to work as expected
					const newPerson = {
						name : name,
						photo: img,
						scores: scoresData.map(parseFloat)
					}

					//post request
					$.post('/api/friends', newPerson, 'json').then((data) => {
						// moving to separate function
						modalContent(data);
					})
				}
			});

			//modal content creation
			function modalContent(match){
				//collect and organize data
				const name = match.name;
				const photo = match.photo;

				//insert data to display
				$('#content').append($('<img>').attr('src', match.photo).attr('height', 250));
				$('#content').append($('<h3>').text(name));

				$('#modal1').modal('open');
				hasBeenClicked = true;
			}
		});
	</script>
</body>
</html>
